<!DOCTYPE html>

<html lang="en" style="margin:0; padding:0; height: 100%;">
    <head>
        <!-- Set this page (hopefully) to not be cached, so it gets reloaded each time the browser refreshes / reloads / reboots.
        Seems to be of particular importance for ChromeOS kisok-mode devices, which seem to cache content between reboots. -->
        <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
        <meta http-equiv="Pragma" content="no-cache"/>
        <meta http-equiv="Expires" content="0"/>
        
        <script>
            var currentSlide = -1;
            var slideTransitionTime = 20000;
            var slideFadeStep = 0.05;
            var slideFadeInterval = 200;
            const resources = <<RESOURCESGOHERE>>;
            
            // An interval function, along with some global variables, to fade between slides.
            var opacity = 1;
            var fadeStartSlide = 1;
            var fadeEndSlide = 1;
            var fadeInterval = 1;
            function fadeSlides() {
                fadeStartSlide.style.opacity = opacity;
                fadeEndSlide.style.opacity = 1 - opacity;
                opacity = opacity - slideFadeStep;
                if (opacity == 0) {
                    clearInterval(fadeInterval);
                    fadeStartSlidestyle.display = "none";
                }
            }
            
            // Display the next slide.
            function showNextSlide() {
                if (resources.length == 1 && currentSlide == 0) {
                    return
                }
                
                nextSlide = currentSlide + 1;
                if (nextSlide == resources.length) {
                    nextSlide = 0;
                }
                
                // Set up the fade effect between the current slide and the next.
                opacity = 1;
                fadeStartSlide = document.getElementById("slide-" + currentSlide);
                fadeEndSlide = document.getElementById("slide-" + nextSlide);
                fadeEndSlide.style.opacity = 0;
                fadeEndSlide.style.display = "block";
                fadeInterval = setInterval(fadeSlides, 200);
                
                currentSlide = nextSlide;
            }
            
            // The page load function - execution starts here.
            function startSlides() {
                // Extract any optional parameters from the URL.
                const searchParams = new URLSearchParams(window.location.search);
                for (const searchParam of searchParams) {
                    if (searchParam[0].toLowerCase() == "transition") {
                        slideTransitionTime = parseInt(searchParam[1]) * 1000;
                    } else if (searchParam[0].toLowerCase() == "fadesteps") {
                        slideFadeStep = 1 / parseInt(searchParam[1]);
                    } else if (searchParam[0].toLowerCase() == "fadeinterval") {
                        slideFadeInterval = Number(searchParam[1]) * 1000;
                    }
                }
                
                // Clone a "slide" DIV for each slide and set the content, this should get the content pre-loaded so there's no wait for
                // content to load when switching from one slide to another.
                slideDiv = document.getElementById("slide");
                slidesDiv = document.getElementById("slides");
                for (slideNum = 0; slideNum < resources.length; slideNum = slideNum + 1) {
                    newSlideDiv = slideDiv.cloneNode();
                    newSlideDiv.id = "slide-" + slideNum;
                    newSlideDiv.style.display = "none";
                    if (resources[slideNum].endsWith(".svg")) {
                        newSlideDiv.innerHTML = "<img src=\"" + resources[slideNum] + "\" width=\"100%\"/>";
                    } else if (resources[slideNum].endsWith(".mp4")) {
                        console.log("Found video: " + resources[slideNum]);
                        newSlideDiv.innerHTML = "<video width=\"100%\" height=\"100%\" autoplay loop><source src=\"" + resources[slideNum] + "\" type=\"video/mp4\"></video>";
                    } else if (resources[slideNum].endsWith(".html")) {
                        console.log("Found HTML page: " + resources[slideNum]);
                        newSlideDiv.innerHTML = "<iframe src=\"" + resources[slideNum] + "\" style=\"width:100vw; height:100vh; overflow-y:hidden; overflow-x:hidden;\"></iframe>";
                    }
                    slidesDiv.appendChild(newSlideDiv);
                }
                // Make sure the intial slide is visible.
                document.getElementById("slide--1").style.display = "block";
                // Set up the slide transition.
                setInterval(showNextSlide, slideTransitionTime);
            }
        </script>
    </head>
    <body onload="startSlides()" style="margin:0; padding:0; height:100vh; max-height:100vh; float:left; width:100vw; overflow-y:hidden; overflow-x:hidden;">
        <div id="slides" style="width:100px; height:100px; background-color:rgb(255,255,255); cursor:url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7), auto;">
            <div id="slide--1" style="position:absolute; top:0; left:0; width:100vw; height:100vh; overflow-y:hidden; overflow-x:hidden;">
                Version Information - Timestamp:
            </div>
            <div id="slide" style="position:absolute; top:0; left:0; width:100vw; height:100vh; overflow-y:hidden; overflow-x:hidden;">
            </div>
        </div>
    </body>
</html>
